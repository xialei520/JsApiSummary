<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <style>
        html {
            font-size: 62.5%
        }

        .ico {
            width: 100%;
            text-align: center;
            height: 200px;
        }

        .ico img {
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 100%;
        }
        #get_aptcha {
				display: block;
				position: absolute;
				right: 12px;
				top: 8px;
				height: 30px;
				width: 80px;
				background: #1fa35f;
				border: none;
				border-radius: 5px;
				font-size: 12px;
				color: white;
				display: block;
				text-align: center;
				line-height: 20px;
				text-indent: 5px;
			}
    </style>

</head>

<body>

    <div class="  ico">
        <img src="ibc.png" alt="">
    </div>
    <div class="weui-cells weui-cells_form" style="margin:0">
        <div class="weui-cells" style="margin:0">

            <div class="weui-cell weui-cell_select weui-cell_select-before">
                <div class="weui-cell__hd">
                    <select class="weui-select" name="select2">
                        <option value="1" style="display: none; ">+86</option>

                    </select>
                </div>
                <div class="weui-cell__bd">
                    <input id="account" class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入号码">
                </div>
            </div>
        </div>
        <div class="weui-cell weui-cell_vcode" style="height: 45px;">
            <div class="weui-cell__hd">
                <label class="weui-label">验证码</label>
            </div>
            <div class="weui-cell__bd">
                <input id="captcha" class="weui-input" type="tel" placeholder="请输入验证码">
            </div>
            <div class="weui-cell__ft">
                <input type="button" id="get_aptcha" value="获取验证码" />
            </div>

            <!-- 隐藏dom，用于接受数据 -->
            <div class="mui-input-row" style="display: none;">
                <label>验证码</label>
                <input id='ycode' type="text" class=" mui-input" value="1">
            </div>
        </div>
        <div class="weui-cell" style="border-bottom:1px solid #e5e5e5;">
            <div class="weui-cell__hd">
                <label class="weui-label">姓名</label>
            </div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" placeholder="请输入真实姓名">
            </div>
        </div>
        <div class="weui-btn-area">
            <a class="weui-btn weui-btn_primary" href="javascript:" id="reg">注册</a>
        </div>
    </div>
    <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
    <script>

         
        $('#get_aptcha').click(function () {
            var oinput = document.getElementById('account');
            var Value = oinput.value.replace(/\s/g, "");
            oinput.value = Value;
            console.log(oinput.value);
            var _this = this;
            if (Value.length == 11) {
                $.ajax({
                    url: 'http://cs.shangzeintl.com/api/index.php?s=/home/app/Existphone',
                    data: {
                        phone: oinput.value
                    },
                    type: 'post',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        if (data.ok == '0') {
                            settime(_this);
                            console.log('000000000000000000000000000')
                            $.ajax({
                                url: 'http://cs.shangzeintl.com/api/index.php?s=/home/app/SetSms',
                                data: {
                                    phone: oinput.value
                                },
                                dataType: 'json',
                                type: 'post',
                                success: function (data) {
                                    console.log(data.ok);
                                    if (data.ok == '0') {
                                        // mui.toast('验证码发送成功!');
                                        $.toast("验证码发送成功", "text");
                                        console.log(data.ycode);
                                        document.getElementById("ycode").value = data.ycode;
                                    } else {
                                        // mui.toast('验证码发送失败');
                                        $.toast("验证码发送失败", "text");
                                        
                                    }
                                },
                                error: function () { }
                            })
                        } else {
                            // mui.toast('手机号码已经存在，你可直接登陆');
                            // mui.openWindow({
                            //     url: 'login.html',
                            //     id: 'login'
                            // });
                            $.toast("手机号码已经存在，你可直接登陆", "text");
                            
                        }
                    },
                    error: function () {

                    }
                })
            } else {
                // mui.toast('手机号码填写不正确！');
                $.toast("手机号码填写不正确！", "text");
                
            }

        })
        var countdown = 60;
        //验证码倒计时
        function settime(obj) {
            if (countdown == 0) {
                obj.removeAttribute("disabled");
                obj.value = "获取验证码";
                countdown = 60;
                return;
            } else {
                obj.setAttribute("disabled", true);
                obj.value = "重新发送(" + countdown + ")";
                countdown--;
            }
            setTimeout(function () {
                settime(obj)
            }, 1000)
        }
        //获取后台验证码
        var reg = document.getElementById("reg");
        reg.onclick = function () {

            var ycode = document.getElementById('ycode').value;
            var app_name = document.getElementById("account").value;
            var app_captcha = document.getElementById("captcha").value;
            var oinput = document.getElementById('account');
            var Value = oinput.value.replace(/\s/g, "");
            oinput.value = Value;
            var _this = this;
            /*webviewShow = plus.webview.create('nextreg.html', 'nextreg', {}, {
                app_name: app_name,
            });*/
            if (Value.length == 11) {
                if (ycode == app_captcha) {
                    // var nwaiting = plus.nativeUI.showWaiting();
                    // webviewShow = plus.webview.create('userinfo.html', 'userinfo', {}, {
                    //     app_name: app_name,
                    // });
                    // plus.nativeUI.closeWaiting();
                    $.toast("注册成功！！！", "text");
                    
                } else {
                    // mui.toast('验证码输入不正确！！！');
                    $.toast("验证码输入不正确！！！", "text");
                    
                }
            } else {
                // mui.toast('手机号格式不正确！！！');
                $.toast("手机号格式不正确！！！", "text");
                
            }
        };
    </script>
</body>

</html>